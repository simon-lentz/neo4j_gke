# Neo4j Helm Chart Values - Dev Environment
# See https://neo4j.com/docs/operations-manual/current/kubernetes/helm-charts-setup/

neo4j:
  # Use Enterprise Edition for backup support
  edition: enterprise
  acceptLicenseAgreement: "yes"
  # Password is set via Terraform set_sensitive block

# Service Configuration
services:
  # Disable external LoadBalancer (use internal only)
  neo4j:
    enabled: false
  # Enable ClusterIP for in-cluster access
  default:
    enabled: true
    type: ClusterIP
  # Enable admin service for backups
  admin:
    enabled: true
    type: ClusterIP

# =============================================================================
# SECURITY NOTE: Development Configuration Only
# =============================================================================
# The following TLS settings are intentionally permissive for local development:
# - HTTP enabled for Neo4j Browser access without certificates
# - HTTPS disabled to avoid certificate management overhead
# - Bolt TLS optional to allow unencrypted driver connections
#
# For production deployments, update these settings:
#   server.http.enabled: "false"        # Disable unencrypted HTTP
#   server.https.enabled: "true"        # Enable HTTPS with valid certificate
#   server.bolt.tls_level: "REQUIRED"   # Enforce TLS on all Bolt connections
#
# Production also requires:
# - TLS certificate provisioning (cert-manager or manual Kubernetes Secret)
# - Certificate secret referenced in Helm values
# =============================================================================

# Neo4j Configuration
config:
  # Use Cypher 25 as default query language
  db.query.default_language: "CYPHER_25"
  # HTTP (Neo4j Browser) controlled by Terraform variable enable_neo4j_browser
  server.https.enabled: "false"
  # Bolt TLS optional for dev (required for prod)
  server.bolt.tls_level: "OPTIONAL"
  # Enable backup listener
  server.backup.listen_address: "0.0.0.0:6362"
  server.backup.enabled: "true"

# Volume Configuration
volumes:
  data:
    mode: "defaultStorageClass"
    defaultStorageClass:
      requests:
        storage: 10Gi

# Resource Configuration for Autopilot
# Autopilot will auto-scale resources, but we set reasonable defaults
resources:
  requests:
    cpu: "500m"
    memory: "2Gi"

# Pod Configuration
podSpec:
  # Allow scheduling on any node (Autopilot handles this)
  nodeSelector: {}
  tolerations: []
  # Pod-level security context
  # See: https://kubernetes.io/docs/tasks/configure-pod-container/security-context/
  securityContext:
    runAsNonRoot: true
    runAsUser: 7474       # Standard Neo4j UID in official images
    runAsGroup: 7474
    fsGroup: 7474         # Required for volume access
    seccompProfile:
      type: RuntimeDefault

# Container Security Context
# Note: readOnlyRootFilesystem must be false - Neo4j requires write access to
# /var/lib/neo4j/data, /var/lib/neo4j/logs, and /tmp for normal operation.
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL

# Logging
logs:
  # Send logs to stdout for collection
  redirectQueryLog: true

# Metrics (optional - enable if using Prometheus)
metrics:
  prometheus:
    enabled: false
